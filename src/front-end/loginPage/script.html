<script>
  (function () {
    console.log(`Проверка авторизации`)
    let email = localStorage.getItem('email');
    let sshKey = localStorage.getItem('sshKey');
    let sheetId = localStorage.getItem('sheetId');
    console.log(`email`)
    console.log(email)
    console.log(`sshKey`)
    console.log(sshKey)
    console.log(`sheetId`)
    console.log(sheetId)


    if (email === null || sshKey === null || sheetId === null) {
      console.log("Не авторизирован!");
      return false;
    }
    // проверить все три ключа, если все ок - перенаправить на домашнюю страницу
    google.script.run.withSuccessHandler(prosessRedirect).checkAuthData([email, sshKey, sheetId]);
  })();





  // перенаправляем в личный кабинет, передавая id таблицы пользователя с данными
  function prosessRedirect(response) {
    let sheetId;
    console.log(response)
    if (response.success == true && response.newUser == true) {
      console.log(`попал в первый иф`)
      localStorage.setItem('email', response.userEmail);
      localStorage.setItem('sshKey', response.ssh);
      localStorage.setItem('sheetId', response.userSheetId);
      sheetId = response.userSheetId;
    } else if (response.success == true && response.newUser == false) {
      console.log(`попал в второй иф`)
      sheetId = response.userSheetId;
    } else {
      console.log('не авторизирован')
      return false
    }
    console.log(`вышел сюда`)

    // console.log(sheetID)
    let currenUrl = document.getElementById('currentUrl').value;
    console.log(currenUrl)
    let link = document.createElement("a");
    // link.setAttribute("href", `${currentUrl}?v=home&sheetId=${sheetID}`);
    link.setAttribute("href", `${String(currentUrl.value)}?v=home`);
    link.setAttribute("id", 'uiLink');
    link.innerText = '';
    document.body.append(link);
    console.log('Сработало')
    setTimeout(() => document.getElementById('uiLink').click(), 3000);
  }































  const INPUTS = ["loginFormEmail", "loginFormPassword"];
  const SUBMIT_BUTTON = document.getElementById("loginFormSbmBtn");

  SUBMIT_BUTTON.addEventListener('click', checkUserLogin);

  function checkUserLogin() {
    console.log('Отправляю данные на сервер...')
    let inputsData = {};
      for (let i = 0; i < INPUTS.length; i++) {
        inputsData[INPUTS[i]] = document.getElementById(INPUTS[i]).value;
      }
      google.script.run.withSuccessHandler(prosessRedirect)
          .checkLoginForm(inputsData);
  }


</script>