<script>
  (function () {
    console.log(`Проверка авторизации`)
    let email = localStorage.getItem('email');
    let sshKey = localStorage.getItem('sshKey');
    let sheetId = localStorage.getItem('sheetId');
    console.log(`email`)
    console.log(email)
    console.log(`sshKey`)
    console.log(sshKey)
    console.log(`sheetId`)
    console.log(sheetId)


    if (email === null || sshKey === null || sheetId === null) {
      console.log("Не авторизирован!");
      return false;
    }
    // проверить все три ключа, если все ок - перенаправить на домашнюю страницу
    google.script.run.withSuccessHandler(prosessRedirect).checkAuthData([email, sshKey, sheetId]);
  })();






  // function checkSSHKey(sshKey) {
  //   google.script.run.withSuccessHandler(loadUi)
  //     .server_checkSSH(sshKey);
  // }

  // function loadUi(response) {
  //   if (response === false) {
  //     console.log("Проверка не пройдена остаться на форме логина!");
  //     console.log(response)
  //     return false;
  //   } else {
  //     console.log("Проверка пройдена, показать форму ввода бюджета!");
  //     console.log(response)
  //     redirect(response)
  //     // создание кнопки и клик по ней - функция
  //   }
  // }

  // function redirect(object) {
  //   let loader = document.getElementById('loader');
  //   let submitButtonSpan = document.getElementById('submitButtonSpan');
  //   let currentUrl = document.getElementById('currentUrl').value;
  //   let link = document.createElement("a");
  //   link.setAttribute("href", `${currentUrl}?v=${object.success}`);
  //   link.setAttribute("id", 'uiLink');
  //   link.innerText = '';
  //   document.body.append(link);
  //   loader.classList.toggle("disabled");
  //   submitButtonSpan.classList.toggle("hidden");
  //   setTimeout(() => document.getElementById('uiLink').click(), 3000);
  // }


  // перенаправляем в личный кабинет, передавая id таблицы пользователя с данными
  function prosessRedirect(response) {
    let sheetId;
    console.log(response)
    if (response.success == true && response.newUser == true) {
      console.log(`попал в первый иф`)
      localStorage.setItem('email', response.userEmail);
      localStorage.setItem('sshKey', response.ssh);
      localStorage.setItem('sheetId', response.userSheetId);
      sheetId = response.userSheetId;
    } else if (response.success == true && response.newUser == false) {
      console.log(`попал в второй иф`)
      sheetId = response.userSheetId;
    } else {
      console.log('не авторизирован')
      return false
    }
    console.log(`вышел сюда`)

    // console.log(sheetID)
    let currenUrl = document.getElementById('currentUrl').value;
    console.log(currenUrl)
    let link = document.createElement("a");
    // link.setAttribute("href", `${currentUrl}?v=home&sheetId=${sheetID}`);
    link.setAttribute("href", `${String(currentUrl.value)}?v=home`);
    link.setAttribute("id", 'uiLink');
    link.innerText = '';
    document.body.append(link);
    console.log('Сработало')
    setTimeout(() => document.getElementById('uiLink').click(), 3000);
  }






</script>